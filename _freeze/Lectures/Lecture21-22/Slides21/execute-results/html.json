{
  "hash": "552ee431a38518f45294d918cd3730fc",
  "result": {
    "markdown": "---\ntitle: |\n  | ECON 340  \n  | Economics Research Methods\nauthor: |\n  | Div Bhagia\n  |\n  | Lecture 21: Regression Analysis in R\ndate: |\ndocumentclass: slidesLight\noutput:\n  beamer_presentation\nheader-includes:\n  - \\renewcommand{\\tightlist}{\\setlength{\\itemsep}{10pt}\\setlength{\\parskip}{0pt}}\nurlcolor: blue\n---\n\n\n\n\n### Housekeeping\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrm(list=ls())\nlibrary(tidyverse)\nlibrary(stargazer)\n#setwd(\"~/Dropbox (CSU Fullerton)/Econ340_R\")\ndata <- read.csv(\"caschool.csv\")\n```\n:::\n\n\n### Scatterplot\n\\vspace{-1em}\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(data, aes(x=str, y=testscr)) +\n  geom_point() +\n  theme_classic()\n```\n\n::: {.cell-output-display}\n![](Slides21_files/figure-html/unnamed-chunk-2-1.png){fig-align='center' width=288}\n:::\n:::\n\n\n### Scatterplot\n\\vspace{-1em}\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(data, aes(x=str, y=testscr)) +\n  geom_point(shape=1) + theme_classic() +\n  labs(x=\"Student-Teacher Ratio\", y=\"Test Score\")\n```\n\n::: {.cell-output-display}\n![](Slides21_files/figure-html/unnamed-chunk-3-1.png){fig-align='center' width=288}\n:::\n:::\n\n\n### Linear Regression \n- `lm()` is a function used to fit linear regression models\n- Syntax: `lm(y ~ x1 + x2 + ... , data = mydata)`\n- Useful to store it as an object\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmodel <- lm(testscr ~ str, data)\n```\n:::\n\n\n- Apply `summary()` function to the stored result from output\n\n### Regression Output\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsummary(model)\n```\n:::\n\n\\includegraphics[scale=0.3]{./../../output/reg_output.png}\n\n### Regression Output\n- Fitted model: $$ \\hat{testscr} = 698.93 - 2.28 \\cdot str  $$\n- $R^2 = 0.05$ implies that 5\\% of variation in test scores explained by student teacher ratio\n- Standard errors (deviations): $$ SE_{\\hat{\\beta_0}} = 9.47, \\quad SE_{\\hat{\\beta_1}} = 0.48 $$\n\n### Regression Output\n- Often interested in testing the hypothesis: $H_0: \\beta_1 = 0 \\text{ against } H_1: \\beta_1 \\neq 0$\n- Corresponding t-value: $$ t_0 = \\frac{\\hat{\\beta_1}}{SE_{\\hat{\\beta_1}}} = \\frac{- 2.28}{0.48} = -4.75$$\n- p-value: $p = 2 Pr(Z>t_0)$\n- If $p<\\alpha$, coefficient significant at $\\alpha \\%$ level of significance\n\n### Confidence Intervals\n- $(1-\\alpha)\\%$ confidence interval is given by: $\\hat{\\beta_1} \\pm z_{\\alpha/2} \\cdot SE_{\\hat{\\beta_1}}$\n- Note that $z_{0.025}=1.96$, so the 95\\% confidence interval: $$-2.28 \\pm 1.96 \\cdot 0.48$$\n\n    ::: {.cell layout-align=\"center\"}\n    \n    ```{.r .cell-code}\n    confint(model)\n    ```\n    \n    ::: {.cell-output .cell-output-stdout}\n    ```\n                    2.5 %     97.5 %\n    (Intercept) 680.32313 717.542779\n    str          -3.22298  -1.336637\n    ```\n    :::\n    :::\n\n\n### Predicted and Residual Values\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndata$yhat <- predict(model)\ndata$uhat <- residuals(model)\n```\n:::\n\nShould the average of `testscr` and `yhat` be the same?\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmean(data$testscr)\nmean(data$yhat)\n```\n:::\n\nWhat should be the average of `uhat`?\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmean(data$uhat)\n```\n:::\n\n\n### Predicted and Residual Values\nWhat is the predicted value when `str`=21?\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndata %>% select(testscr, str, yhat, uhat) %>% \n  filter(str==21)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  testscr str    yhat      uhat\n1   616.3  21 651.057 -34.75699\n```\n:::\n:::\n\nRemember: \n$$ \\hat{testscr} = 698.93 - 2.28 \\cdot str  $$\nNote that: $\\hat{u_i} = Y_i-\\hat{Y}_i$\n\n### Plotting the Fitted Line\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(data, aes(x=str, y=testscr)) +\n  geom_point(shape=1) + theme_classic() +\n  geom_line(aes(y=yhat)) \n```\n\n::: {.cell-output-display}\n![](Slides21_files/figure-html/unnamed-chunk-10-1.png){fig-align='center' width=288}\n:::\n:::\n\n### Output using Stargazer\n\\vspace{-0.5em}\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nstargazer(model, type=\"text\", \n          keep.stat = c(\"n\", \"adj.rsq\"))\n```\n:::\n\n\\vspace{-1em}\n\\begin{center}\n\n::: {.cell layout-align=\"center\"}\n\n\\begingroup \n\\small \n\\begin{tabular}{@{\\extracolsep{5pt}}lc} \n\\\\[-1.8ex]\\hline \n\\hline \\\\[-1.8ex] \n & \\multicolumn{1}{c}{\\textit{Dependent variable:}} \\\\ \n\\cline{2-2} \n\\\\[-1.8ex] & testscr \\\\ \n\\hline \\\\[-1.8ex] \n str & $-$2.280$^{***}$ \\\\ \n  & (0.480) \\\\ \n  & \\\\ \n Constant & 698.933$^{***}$ \\\\ \n  & (9.467) \\\\ \n  & \\\\ \n\\hline \\\\[-1.8ex] \nObservations & 420 \\\\ \nAdjusted R$^{2}$ & 0.049 \\\\ \n\\hline \n\\hline \\\\[-1.8ex] \n\\textit{Note:}  & \\multicolumn{1}{r}{$^{*}$p$<$0.1; $^{**}$p$<$0.05; $^{***}$p$<$0.01} \\\\ \n\\end{tabular} \n\\endgroup \n:::\n\n\\end{center}\n\n### Output from Multiple Models\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmodel1 <- lm(math_scr ~ str, data)\nmodel2 <- lm(read_scr ~ str, data)\nstargazer(model1, model2, type=\"text\", \n          keep.stat = c(\"n\", \"adj.rsq\"))\n```\n:::\n\n\n### Output from Multiple Models\n\\begin{center}\n\n::: {.cell layout-align=\"center\"}\n\n\\begingroup \n\\small \n\\begin{tabular}{@{\\extracolsep{5pt}}lcc} \n\\\\[-1.8ex]\\hline \n\\hline \\\\[-1.8ex] \n & \\multicolumn{2}{c}{\\textit{Dependent variable:}} \\\\ \n\\cline{2-3} \n\\\\[-1.8ex] & math\\_scr & read\\_scr \\\\ \n\\\\[-1.8ex] & (1) & (2)\\\\ \n\\hline \\\\[-1.8ex] \n str & $-$1.939$^{***}$ & $-$2.621$^{***}$ \\\\ \n  & (0.476) & (0.504) \\\\ \n  & & \\\\ \n Constant & 691.417$^{***}$ & 706.449$^{***}$ \\\\ \n  & (9.382) & (9.941) \\\\ \n  & & \\\\ \n\\hline \\\\[-1.8ex] \nObservations & 420 & 420 \\\\ \nAdjusted R$^{2}$ & 0.036 & 0.059 \\\\ \n\\hline \n\\hline \\\\[-1.8ex] \n\\textit{Note:}  & \\multicolumn{2}{r}{$^{*}$p$<$0.1; $^{**}$p$<$0.05; $^{***}$p$<$0.01} \\\\ \n\\end{tabular} \n\\endgroup \n:::\n\n\\end{center}\n\n### Multiple Regression Model \n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmodel3 <- lm(testscr ~ str + comp_stu, data)\nstargazer(model, model3, type=\"text\", \n          keep.stat = c(\"n\", \"adj.rsq\"))\n```\n:::\n\n- Note: Use the adjusted $R^2$ to compare two models with different number of variables\n\n### Multiple Regression Model \n\\begin{center}\n\n::: {.cell layout-align=\"center\"}\n\n\\begingroup \n\\small \n\\begin{tabular}{@{\\extracolsep{5pt}}lcc} \n\\\\[-1.8ex]\\hline \n\\hline \\\\[-1.8ex] \n & \\multicolumn{2}{c}{\\textit{Dependent variable:}} \\\\ \n\\cline{2-3} \n\\\\[-1.8ex] & \\multicolumn{2}{c}{testscr} \\\\ \n\\\\[-1.8ex] & (1) & (2)\\\\ \n\\hline \\\\[-1.8ex] \n str & $-$2.280$^{***}$ & $-$1.593$^{***}$ \\\\ \n  & (0.480) & (0.493) \\\\ \n  & & \\\\ \n comp\\_stu &  & 65.160$^{***}$ \\\\ \n  &  & (14.351) \\\\ \n  & & \\\\ \n\\hline \\\\[-1.8ex] \nObservations & 420 & 420 \\\\ \nAdjusted R$^{2}$ & 0.049 & 0.092 \\\\ \n\\hline \n\\hline \\\\[-1.8ex] \n\\textit{Note:}  & \\multicolumn{2}{r}{$^{*}$p$<$0.1; $^{**}$p$<$0.05; $^{***}$p$<$0.01} \\\\ \n\\end{tabular} \n\\endgroup \n:::\n\n\\end{center}\n\n### Omitted Variable Bias\n- Negative coefficient on `str` smaller in magnitude after controlling for `comp_stu`\n- Lower `comp_stu` $\\rightarrow$ Lower `testscr`\n- Lower `comp_stu` $\\leftrightarrow$ Higher `str`\n- So `comp_stu` explains some of the relationship between `str` and `testscr`\n\n### Omitted Variable Bias\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](Slides21_files/figure-html/unnamed-chunk-17-1.png){fig-align='center' width=288}\n:::\n:::\n\n\n### Next Class\n- For the next class download and load `acs2019` dataset from the Dropbox folder\n- We will continue with linear regression in R\n- Come prepared so we can start quickly\n",
    "supporting": [
      "Slides21_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}