{
  "hash": "52bbdf43fd808c8066c9a6d328fb4acf",
  "result": {
    "markdown": "---\ntitle: |\n  | ECON 340  \n  | Economics Research Methods\nauthor: |\n  | Div Bhagia\n  |\n  | Lecture 22: Regression Analysis in R\ndate: |\ndocumentclass: slidesLight\noutput:\n  beamer_presentation\nheader-includes:\n  - \\renewcommand{\\tightlist}{\\setlength{\\itemsep}{10pt}\\setlength{\\parskip}{0pt}}\nurlcolor: blue\n---\n\n\n\n\n### Housekeeping\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrm(list=ls())\nlibrary(tidyverse)\nlibrary(stargazer)\n#setwd(\"~/Dropbox (CSU Fullerton)/Econ340_R\")\ndata <- read.csv(\"acs2019.csv\")\n```\n:::\n\n\n### Preparing the data\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Select sample and variables\ndata <- data %>% \n  filter(empstat==1) %>% \n  select(-fertyr, -rent)\n\n# Remove missing values\ndata <- na.omit(data)\n```\n:::\n\n\n### Hourly wage and age\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(data, aes(x=age, y=hrly_wage)) +\n  geom_point() + theme_classic()\n```\n\n::: {.cell-output-display}\n![](Slides22_files/figure-html/unnamed-chunk-3-1.png){fig-align='center' width=288}\n:::\n:::\n\n\n### Hourly wage and age\n- Too much data to make sense\n- Better to plot average hourly wage at each wage\n- use `stat_summary()` and specify `fun` as `mean`\n\n### Average wages by age\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(data, aes(x=age, y=hrly_wage)) +\n      stat_summary(fun = mean, geom = \"point\") + \n      theme_classic()\n```\n\n::: {.cell-output-display}\n![](Slides22_files/figure-html/unnamed-chunk-4-1.png){fig-align='center' width=288}\n:::\n:::\n\n\n### Hourly wage and age\n- To fit a quadratic model, generate age-squared term\n\n    ::: {.cell layout-align=\"center\"}\n    \n    ```{.r .cell-code}\n    data <- data %>% \n      mutate(age.sq = age*age)\n    ```\n    :::\n\n- Fit linear and quadratic model\n\n    ::: {.cell layout-align=\"center\"}\n    \n    ```{.r .cell-code}\n    mdl.lnr <- lm(hrly_wage ~ age, data)\n    mdl.qdr <- lm(hrly_wage ~ age + age.sq, data)\n    ```\n    :::\n\n- Output using `stargazer()`\n\n    ::: {.cell layout-align=\"center\"}\n    \n    ```{.r .cell-code}\n    stargazer(mdl.lnr, mdl.qdr, type=\"text\")\n    ```\n    :::\n\n    \n### Hourly wage and age\n\\begin{center}\n\n::: {.cell layout-align=\"center\"}\n\n\\begingroup \n\\small \n\\begin{tabular}{@{\\extracolsep{5pt}}lcc} \n\\\\[-1.8ex]\\hline \n\\hline \\\\[-1.8ex] \n & \\multicolumn{2}{c}{\\textit{Dependent variable:}} \\\\ \n\\cline{2-3} \n\\\\[-1.8ex] & \\multicolumn{2}{c}{hrly\\_wage} \\\\ \n\\\\[-1.8ex] & (1) & (2)\\\\ \n\\hline \\\\[-1.8ex] \n age & 0.375$^{***}$ & 2.056$^{***}$ \\\\ \n  & (0.020) & (0.198) \\\\ \n  & & \\\\ \n age.sq &  & $-$0.021$^{***}$ \\\\ \n  &  & (0.002) \\\\ \n  & & \\\\ \n\\hline \\\\[-1.8ex] \nObservations & 17,109 & 17,109 \\\\ \nAdjusted R$^{2}$ & 0.021 & 0.025 \\\\ \n\\hline \n\\hline \\\\[-1.8ex] \n\\textit{Note:}  & \\multicolumn{2}{r}{$^{*}$p$<$0.1; $^{**}$p$<$0.05; $^{***}$p$<$0.01} \\\\ \n\\end{tabular} \n\\endgroup \n:::\n\n\\end{center}\n\n### Plotting the fitted curve\n\\vspace{-1em}\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndata$prd.qdr <- predict(mdl.qdr)\nggplot(data, aes(x=age, y=hrly_wage)) +\n      stat_summary(fun = mean, geom = \"point\") + \n      geom_line(aes(y=prd.qdr)) + theme_classic()\n```\n\n::: {.cell-output-display}\n![](Slides22_files/figure-html/unnamed-chunk-9-1.png){fig-align='center' width=288}\n:::\n:::\n\n\n\n### Dummy variables\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndata %>% group_by(female) %>% \n  summarise(avg_wages=mean(hrly_wage))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 2\n  female avg_wages\n   <int>     <dbl>\n1      0      31.3\n2      1      25.8\n```\n:::\n:::\n\n### Dummy variables\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmdl1 <- lm(hrly_wage ~ female, data)\nmdl2 <- lm(hrly_wage ~ female + yrs_educ, data)\nmdl3 <- lm(hrly_wage ~ female*yrs_educ, data)\n\nstargazer(mdl1, mdl2, mdl3, type=\"text\")\n```\n:::\n\n\n### Dummy variables\n\\vspace{-1em}\n\\begin{center}\n\n::: {.cell layout-align=\"center\"}\n\n\\begingroup \n\\small \n\\begin{tabular}{@{\\extracolsep{5pt}}lccc} \n\\\\[-1.8ex]\\hline \n\\hline \\\\[-1.8ex] \n & \\multicolumn{3}{c}{\\textit{Dependent variable:}} \\\\ \n\\cline{2-4} \n\\\\[-1.8ex] & \\multicolumn{3}{c}{hrly\\_wage} \\\\ \n\\\\[-1.8ex] & (1) & (2) & (3)\\\\ \n\\hline \\\\[-1.8ex] \n female & $-$5.512$^{***}$ & $-$7.067$^{***}$ & $-$0.963 \\\\ \n  & (0.354) & (0.334) & (1.611) \\\\ \n  & & & \\\\ \n yrs\\_educ &  & 2.637$^{***}$ & 2.833$^{***}$ \\\\ \n  &  & (0.055) & (0.075) \\\\ \n  & & & \\\\ \n female:yrs\\_educ &  &  & $-$0.429$^{***}$ \\\\ \n  &  &  & (0.111) \\\\ \n  & & & \\\\ \n\\hline \\\\[-1.8ex] \nObservations & 17,109 & 17,109 & 17,109 \\\\ \nAdjusted R$^{2}$ & 0.014 & 0.130 & 0.131 \\\\ \n\\hline \n\\hline \\\\[-1.8ex] \n\\textit{Note:}  & \\multicolumn{3}{r}{$^{*}$p$<$0.1; $^{**}$p$<$0.05; $^{***}$p$<$0.01} \\\\ \n\\end{tabular} \n\\endgroup \n:::\n\n\\end{center}\n\n### Model 2\n\\vspace{-0.5em}\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndata$prd2 <- predict(mdl2)\nggplot(data, aes(x=yrs_educ, y=prd2, group=female)) +\n  geom_line(aes(color=female)) + theme_classic()\n```\n\n::: {.cell-output-display}\n![](Slides22_files/figure-html/unnamed-chunk-13-1.png){fig-align='center' width=288}\n:::\n:::\n\n\n### Factor variables\n- R thinks of all variables as numeric unless you tell it otherwise\n- To create a factor variable (specifying levels and labels is optional)\n\n    ::: {.cell layout-align=\"center\"}\n    \n    ```{.r .cell-code}\n    data$fem.fct <- factor(data$female, levels = c(0,1), \n                       labels = c('Female', 'Male'))\n    table(data$fem.fct)\n    ```\n    \n    ::: {.cell-output .cell-output-stdout}\n    ```\n    \n    Female   Male \n      8886   8223 \n    ```\n    :::\n    :::\n\n\n### Model 3\n\\vspace{-0.5em}\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndata$prd3 <- predict(mdl3)\nggplot(data, aes(x=yrs_educ, y=prd3, group=fem.fct)) +\n  geom_line(aes(color=fem.fct)) + theme_classic()\n```\n\n::: {.cell-output-display}\n![](Slides22_files/figure-html/unnamed-chunk-15-1.png){fig-align='center' width=288}\n:::\n:::\n\n\n### More Interaction Terms\n\\vspace{-0.5em}\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmdl.int1 <- lm(hrly_wage ~ female*married, data)\nstargazer(mdl.int1, type=\"text\")\n```\n:::\n\n\\begin{center}\n\n::: {.cell layout-align=\"center\"}\n\n\\begingroup \n\\small \n\\begin{tabular}{@{\\extracolsep{5pt}}lc} \n\\\\[-1.8ex]\\hline \n\\hline \\\\[-1.8ex] \n & \\multicolumn{1}{c}{\\textit{Dependent variable:}} \\\\ \n\\cline{2-2} \n\\\\[-1.8ex] & hrly\\_wage \\\\ \n\\hline \\\\[-1.8ex] \n female & $-$1.738$^{***}$ \\\\ \n  & (0.548) \\\\ \n  & \\\\ \n married & 10.652$^{***}$ \\\\ \n  & (0.495) \\\\ \n  & \\\\ \n female:married & $-$6.070$^{***}$ \\\\ \n  & (0.710) \\\\ \n  & \\\\ \n\\hline \\\\[-1.8ex] \nObservations & 17,109 \\\\ \nAdjusted R$^{2}$ & 0.044 \\\\ \n\\hline \n\\hline \\\\[-1.8ex] \n\\textit{Note:}  & \\multicolumn{1}{r}{$^{*}$p$<$0.1; $^{**}$p$<$0.05; $^{***}$p$<$0.01} \\\\ \n\\end{tabular} \n\\endgroup \n:::\n\n\\end{center}\n\n### More Interaction Terms\n\\vspace{-0.5em}\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmdl.int2 <- lm(hrly_wage ~ black*female, data)\nstargazer(mdl.int2, type=\"text\")\n```\n:::\n\n\\begin{center}\n\n::: {.cell layout-align=\"center\"}\n\n\\begingroup \n\\small \n\\begin{tabular}{@{\\extracolsep{5pt}}lc} \n\\\\[-1.8ex]\\hline \n\\hline \\\\[-1.8ex] \n & \\multicolumn{1}{c}{\\textit{Dependent variable:}} \\\\ \n\\cline{2-2} \n\\\\[-1.8ex] & hrly\\_wage \\\\ \n\\hline \\\\[-1.8ex] \n black & $-$7.645$^{***}$ \\\\ \n  & (0.912) \\\\ \n  & \\\\ \n female & $-$5.817$^{***}$ \\\\ \n  & (0.370) \\\\ \n  & \\\\ \n black:female & 4.659$^{***}$ \\\\ \n  & (1.249) \\\\ \n  & \\\\ \n\\hline \\\\[-1.8ex] \nObservations & 17,109 \\\\ \nAdjusted R$^{2}$ & 0.019 \\\\ \n\\hline \n\\hline \\\\[-1.8ex] \n\\textit{Note:}  & \\multicolumn{1}{r}{$^{*}$p$<$0.1; $^{**}$p$<$0.05; $^{***}$p$<$0.01} \\\\ \n\\end{tabular} \n\\endgroup \n:::\n\n\\end{center}\n\n### Variables with several categories\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Specify levels and labels\nlevs <- c(1, 2, 3, 4, 5)\nlabs <- c(\"Less than HS\", \"High School\", \n          \"Some College\", \"College Degree\", \n          \"More than College\")\n\n# Create factor variable\ndata$educ.fct <- factor(data$educ_cat, \n                        levels=levs, labels=labs)\n```\n:::\n\n\n### Variables with several categories\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndata %>% group_by(educ.fct) %>%\n  summarise(m = mean(hrly_wage))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 × 2\n  educ.fct              m\n  <fct>             <dbl>\n1 Less than HS       17.5\n2 High School        20.6\n3 Some College       23.7\n4 College Degree     34.2\n5 More than College  43.5\n```\n:::\n:::\n\n\n### Variables with several categories\n- Want to specify to R to treat education as a categorical variable\n- Which of the following models is correct?\n\n    ::: {.cell layout-align=\"center\"}\n    \n    ```{.r .cell-code}\n    summary(lm(hrly_wage ~ educ_cat, data))\n    summary(lm(hrly_wage ~ as.factor(educ_cat), data))\n    summary(lm(hrly_wage ~ educ.fct, data))\n    ```\n    :::\n\n- Coefficients capture mean differences from the baseline\n    \n### Variables with several categories\n\\begin{center}\n\n::: {.cell layout-align=\"center\"}\n\n\\begingroup \n\\scriptsize \n\\begin{tabular}{@{\\extracolsep{5pt}}lc} \n\\\\[-1.8ex]\\hline \n\\hline \\\\[-1.8ex] \n & \\multicolumn{1}{c}{\\textit{Dependent variable:}} \\\\ \n\\cline{2-2} \n\\\\[-1.8ex] & hrly\\_wage \\\\ \n\\hline \\\\[-1.8ex] \n educ.fctHigh School & 3.139$^{***}$ \\\\ \n  & (0.820) \\\\ \n  & \\\\ \n educ.fctSome College & 6.180$^{***}$ \\\\ \n  & (0.831) \\\\ \n  & \\\\ \n educ.fctCollege Degree & 16.715$^{***}$ \\\\ \n  & (0.825) \\\\ \n  & \\\\ \n educ.fctMore than College & 26.035$^{***}$ \\\\ \n  & (0.859) \\\\ \n  & \\\\ \n Constant & 17.497$^{***}$ \\\\ \n  & (0.759) \\\\ \n  & \\\\ \n\\hline \\\\[-1.8ex] \nObservations & 17,109 \\\\ \nAdjusted R$^{2}$ & 0.139 \\\\ \n\\hline \n\\hline \\\\[-1.8ex] \n\\textit{Note:}  & \\multicolumn{1}{r}{$^{*}$p$<$0.1; $^{**}$p$<$0.05; $^{***}$p$<$0.01} \\\\ \n\\end{tabular} \n\\endgroup \n:::\n\n\\end{center}\n\n### Log Transformations\n- Create transformed variable\n\n    ::: {.cell layout-align=\"center\"}\n    \n    ```{.r .cell-code}\n    data$lwage <- log(data$hrly_wage)\n    ```\n    :::\n\n- Fit the model and output results  \n\n    ::: {.cell layout-align=\"center\"}\n    \n    ```{.r .cell-code}\n    mdl.lnr <- lm(hrly_wage ~ yrs_educ, data)\n    mdl.log <- lm(lwage ~ yrs_educ, data)\n    stargazer(mdl.lnr, mdl.log, type=\"text\")\n    ```\n    :::\n\n\n### Log Transformations\n\\begin{center}\n\n::: {.cell layout-align=\"center\"}\n\n\\begingroup \n\\small \n\\begin{tabular}{@{\\extracolsep{5pt}}lcc} \n\\\\[-1.8ex]\\hline \n\\hline \\\\[-1.8ex] \n & \\multicolumn{2}{c}{\\textit{Dependent variable:}} \\\\ \n\\cline{2-3} \n\\\\[-1.8ex] & hrly\\_wage & lwage \\\\ \n\\\\[-1.8ex] & (1) & (2)\\\\ \n\\hline \\\\[-1.8ex] \n yrs\\_educ & 2.524$^{***}$ & 0.086$^{***}$ \\\\ \n  & (0.056) & (0.002) \\\\ \n  & & \\\\ \n Constant & $-$7.223$^{***}$ & 1.901$^{***}$ \\\\ \n  & (0.807) & (0.023) \\\\ \n  & & \\\\ \n\\hline \\\\[-1.8ex] \nObservations & 17,109 & 17,109 \\\\ \nAdjusted R$^{2}$ & 0.107 & 0.147 \\\\ \n\\hline \n\\hline \\\\[-1.8ex] \n\\textit{Note:}  & \\multicolumn{2}{r}{$^{*}$p$<$0.1; $^{**}$p$<$0.05; $^{***}$p$<$0.01} \\\\ \n\\end{tabular} \n\\endgroup \n:::\n\n\\end{center}\n\n### Log Transformations\nHow much does hourly wage change going from 10 to 11 years of education?\n\n- Linear model: \\$2.52\n- Log-level model: 100 $\\times$ 0.086 = 8.6\\% of \\$18.87 = \\$1.68\n\n    ::: {.cell layout-align=\"center\"}\n    \n    ```{.r .cell-code}\n    data %>% filter(yrs_educ==10) %>% \n      summarise(m = mean(hrly_wage))\n    ```\n    \n    ::: {.cell-output .cell-output-stdout}\n    ```\n             m\n    1 18.87474\n    ```\n    :::\n    :::\n\n\n### Log Transformations\n- What about going from 13 to 14 years of education?\n- Fitting a linear model between log wages and years of education $\\rightarrow$ non-linear model between wages and years of education\n\n    ::: {.cell layout-align=\"center\"}\n    \n    ```{.r .cell-code}\n    # Predictions from the log-level model\n    data$lw.hat <- predict(mdl.log) \n    \n    # Convert predictions back to levels\n    data$w.hat <- exp(data$lw.hat)\n    ```\n    :::\n\n\n### Log Transformations\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(data, aes(x=yrs_educ, y=w.hat)) +\n  geom_line() + theme_classic()\n```\n\n::: {.cell-output-display}\n![](Slides22_files/figure-html/unnamed-chunk-29-1.png){fig-align='center' width=288}\n:::\n:::",
    "supporting": [
      "Slides22_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}